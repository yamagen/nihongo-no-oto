
digraph PGM_Flow {
    graph [
        fontsize=14,
        label="Immediate Grammar and Adjustive Grammar: Processing Flow",
        labelloc="t"
    ];

    node [shape=box, style=filled, fillcolor="#FFFFFF", fontsize=12];

    // Immediate Grammar pathway
    subgraph cluster_IG {
        label="Immediate Grammar (System 1)";
        color="#CDE7FF";
        style=filled;

        IG_input   [label="外的刺激・対話の場面\n(situation / turn-taking cue)"];
        IG_react   [label="瞬時の反応生成\n(one-beat reaction)"];
        IG_chunk   [label="chunk の活性化\n(I'm good / I know / Right)"];
        IG_output  [label="即時発話\n(short / reduced / prosodic)"];

        IG_input -> IG_react;
        IG_react -> IG_chunk;
        IG_chunk -> IG_output;
    }

    // Adjustive Grammar pathway
    subgraph cluster_AG {
        label="Adjustive Grammar (System 2)";
        color="#FFE7CD";
        style=filled;

        AG_input    [label="意味・文脈の評価\n(semantic evaluation)"];
        AG_construct[label="文の構築\n(tense/aspect/logical structure)"];
        AG_monitor  [label="モニタリング\n(self-correction / accuracy)"];
        AG_output   [label="調整文法による発話\n(full sentence / written-like)"];

        AG_input -> AG_construct;
        AG_construct -> AG_monitor;
        AG_monitor -> AG_output;
    }

    // Decision flow
    Start [label="発話の開始\n(intent to speak)", shape=oval, fillcolor="#E8E8E8"];
    End   [label="発話の完了", shape=oval, fillcolor="#E8E8E8"];

    Start -> IG_input [label="即時性が必要\n(dialogue / reaction)", fontsize=11];
    Start -> AG_input [label="説明性・正確さが必要\n(monologue / instruction)", fontsize=11];

    IG_output -> End;
    AG_output -> End;

    // Cross-links (interaction)
    IG_output -> AG_input [style=dashed, label="必要に応じ調整", fontsize=11];
    AG_output -> IG_input [style=dashed, label="対話状況により即時化", fontsize=11];
}
